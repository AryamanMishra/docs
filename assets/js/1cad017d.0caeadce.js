"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4333],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),k=r,m=d["".concat(l,".").concat(k)]||d[k]||u[k]||i;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1067:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={},o="Databricks",s={unversionedId:"integrations/databricks",id:"integrations/databricks",title:"Databricks",description:"OpenLineage's Spark Integration can be installed on Databricks by leveraging init scripts. Please note, Databricks on Google Cloud does not currently support the DBFS CLI, so the proposed solution will not work for Google Cloud until that feature is enabled.",source:"@site/docs/integrations/databricks.md",sourceDirName:"integrations",slug:"/integrations/databricks",permalink:"/docs/integrations/databricks",draft:!1,editUrl:"https://github.com/OpenLineage/docs/tree/main/docs/integrations/databricks.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Great Expectations",permalink:"/docs/integrations/great-expectations"},next:{title:"Developing With OpenLineage",permalink:"/docs/development/developing/"}},l={},p=[{value:"Databricks Installation Instructions",id:"databricks-installation-instructions",level:2},{value:"Observe Logs in Driver Logs",id:"observe-logs-in-driver-logs",level:2},{value:"Initialization Logs",id:"initialization-logs",level:3},{value:"For Every Lineage Event",id:"for-every-lineage-event",level:3}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"databricks"},"Databricks"),(0,r.kt)("p",null,"OpenLineage's ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/OpenLineage/OpenLineage/blob/a2d39a7a6f02474b2dfd1484f3a6d2810a5ffe30/integration/spark/README.md"},"Spark Integration")," can be installed on ",(0,r.kt)("a",{parentName:"p",href:"https://www.databricks.com/"},"Databricks")," by leveraging init scripts. Please note, Databricks on Google Cloud does not currently support the DBFS CLI, so the proposed solution will not work for Google Cloud until that feature is enabled. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/databricks/clusters/init-scripts"},"Azure Databricks Init Scripts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.gcp.databricks.com/clusters/init-scripts.html"},"GCP Databricks Init Scripts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.databricks.com/clusters/init-scripts.html"},"AWS Databricks Init Scripts"))),(0,r.kt)("h2",{id:"databricks-installation-instructions"},"Databricks Installation Instructions"),(0,r.kt)("p",null,"Follow the steps below to enable OpenLineage on Databricks."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Build the jar via Gradle or download the ",(0,r.kt)("a",{parentName:"li",href:"https://search.maven.org/remote_content?g=io.openlineage&a=openlineage-spark&v=LATEST"},"latest release"),"."),(0,r.kt)("li",{parentName:"ul"},"Configure the Databricks CLI with your desired workspace:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/en-us/azure/databricks/dev-tools/cli/"},"Azure Databricks CLI")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.gcp.databricks.com/dev-tools/cli/index.html"},"GCP Databricks CLI")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.databricks.com/dev-tools/cli/index.html"},"AWS Databricks CLI")))),(0,r.kt)("li",{parentName:"ul"},"Run ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/OpenLineage/OpenLineage/blob/main/integration/spark/databricks/upload-to-databricks.sh"},(0,r.kt)("inlineCode",{parentName:"a"},"upload-to-databricks.sh"))," or ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/OpenLineage/OpenLineage/blob/main/integration/spark/databricks/upload-to-databricks.ps1"},(0,r.kt)("inlineCode",{parentName:"a"},"upload-to-databricks.ps1")),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This creates a folder in DBFS to store the openlineage jar."),(0,r.kt)("li",{parentName:"ul"},"Copies the jar to the DBFS folder"),(0,r.kt)("li",{parentName:"ul"},"Copies the ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/OpenLineage/OpenLineage/blob/main/integration/spark/databricks/open-lineage-init-script.sh"},(0,r.kt)("inlineCode",{parentName:"a"},"init")," script")," to the DBFS folder"))),(0,r.kt)("li",{parentName:"ul"},"Create an interactive or job cluster with the relevant Spark configs:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"spark.openlineage.endpoint api/v1/lineage\nspark.openlineage.namespace YOURNAMESPACE\nspark.openlineage.url https://YOURHOST\n"))),(0,r.kt)("li",{parentName:"ul"},"Set the cluster ",(0,r.kt)("inlineCode",{parentName:"li"},"init")," script to be: ",(0,r.kt)("inlineCode",{parentName:"li"},"dbfs:/databricks/openlineage/open-lineage-init-script.sh"),".")),(0,r.kt)("h2",{id:"observe-logs-in-driver-logs"},"Observe Logs in Driver Logs"),(0,r.kt)("p",null,"To troubleshoot or observe the OpenLineage information in Databricks, see the ",(0,r.kt)("inlineCode",{parentName:"p"},"Log4j output")," in the Cluster's Driver Logs."),(0,r.kt)("h3",{id:"initialization-logs"},"Initialization Logs"),(0,r.kt)("p",null,"A successful initialization will emit logs in the Log4j output that look similar to the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"YY/MM/DD HH:mm:ss INFO SparkContext: Registered listener io.openlineage.spark.agent.OpenLineageSparkListener\n\nYY/MM/DD HH:mm:ss INFO OpenLineageContext: Init OpenLineageContext: Args: ArgumentParser(host=https://YOURHOST, version=v1, namespace=YOURNAMESPACE, jobName=default, parentRunId=null, apiKey=Optional.empty) URI: https://YOURHOST/api/v1/lineage\n\nYY/MM/DD HH:mm:ss INFO AsyncEventQueue: Process of event SparkListenerApplicationStart(Databricks Shell,Some(app-XXX-0000),YYYY,root,None,None,None) by listener OpenLineageSparkListener took Xs.\n")),(0,r.kt)("h3",{id:"for-every-lineage-event"},"For Every Lineage Event"),(0,r.kt)("p",null,"You will see a message in the Log4j output that looks like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"YY/MM/DD HH:mm:ss INFO OpenLineageContext: Lineage completed successfully: ResponseMessage(responseCode=200, body=null, error=null) <... LINEAGE INFO ...>\n")))}u.isMDXComponent=!0}}]);