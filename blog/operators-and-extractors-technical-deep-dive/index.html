<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="OpenLineage Docs JSON Feed">






<script src="https://plausible.io/js/script.js" defer="defer" data-domain="openlineage.io"></script><title data-rh="true">How Operators and Extractors Work Under-the-Hook | OpenLineage Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.openlineage.io/blog/operators-and-extractors-technical-deep-dive"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How Operators and Extractors Work Under-the-Hook | OpenLineage Docs"><meta data-rh="true" name="description" content="A technical deep-dive on how the Airflow OSS and OpenLineage OSS projects interact."><meta data-rh="true" property="og:description" content="A technical deep-dive on how the Airflow OSS and OpenLineage OSS projects interact."><meta data-rh="true" property="og:image" content="https://docs.openlineage.io/assets/images/image-a2f9cc7ef0b794e59679837eef6c554a.svg"><meta data-rh="true" name="twitter:image" content="https://docs.openlineage.io/assets/images/image-a2f9cc7ef0b794e59679837eef6c554a.svg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-09-07T00:00:00.000Z"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.openlineage.io/blog/operators-and-extractors-technical-deep-dive"><link data-rh="true" rel="alternate" href="https://docs.openlineage.io/blog/operators-and-extractors-technical-deep-dive" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.openlineage.io/blog/operators-and-extractors-technical-deep-dive" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.37c528c9.css">
<link rel="preload" href="/assets/js/runtime~main.6d0b7952.js" as="script">
<link rel="preload" href="/assets/js/main.10b49ce1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/ol-logo.svg" alt="OpenLineage Docs" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/ol-logo.svg" alt="OpenLineage Docs" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a class="navbar__item navbar__link" href="/getting-started">Getting Started</a><a class="navbar__item navbar__link" href="/resources">Resources</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/ecosystem">Ecosystem</a><a class="navbar__item navbar__link" href="/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/OpenLineage/openlineage" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="image" content="https://docs.openlineage.io/assets/images/image-a2f9cc7ef0b794e59679837eef6c554a.svg"><header><h1 class="title_f1Hy" itemprop="headline">How Operators and Extractors Work Under-the-Hook</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-09-07T00:00:00.000Z" itemprop="datePublished">September 7, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Benji Lampel</span></div></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>A technical deep-dive on how the Airflow OSS and OpenLineage OSS projects interact. </p><p><img loading="lazy" src="/assets/images/banner-c5a21bc7ae7d024fdfae0b1e68502afb.svg#banner" width="770" height="190" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>Airflow Operators and OpenLineage Extractors have a specific, if quirky, way of working together. Recently, the way they work together has seen a bit of an overhaul, and the new SQL Check Extractors added a new and unique way that the extractors work and interact with operators. In this blog, we&#x27;ll demystify these relationships.</p><p>Note: This blog post describes the relationships of the operators and extractors only for <code>Airflow&gt;=2.3</code> and <code>OpenLineage&gt;=0.12.0</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration">Integration<a class="hash-link" href="#integration" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-operator-and-the-extractor">The Operator and the Extractor<a class="hash-link" href="#the-operator-and-the-extractor" title="Direct link to heading">​</a></h3><p>Some quick definitions are in order before we continue.</p><p>The Airflow Operator defines a task, which is the unit of work in Airflow. All operators inherit from the <code>BaseOperator</code>, and in addition to taking the arguments of the <code>BaseOperator</code>, they can take arguments specific to the kind of task they are going to perform, such as a specific <code>conn_id</code> to connect to a datasource or a dictionary of checks to perform on that datasource.</p><p>The OpenLineage Extractor is somewhat analogous to the Airflow Operator: it is a unit of work in OpenLineage, which takes the relevant input and output data from an operator, creates OpenLineage data facets, and sends those facets to be displayed in Marquez or Datakin. Each extractor maps to a specific set of operators via the <code>get_operator_classnames()</code> class method. The extractors all inherit from a <code>BaseExtractor</code>, which defines a few abstract methods, importantly <code>execute()</code> and <code>execute_on_complete()</code>.</p><p>Briefly, the two other major OpenLineage constructs in this story are the <code>ExtractorManager</code>, which is responsible for identifying the correct extractor to use, and the <code>Listener</code>, which is the connecting piece between OpenLineage and Airflow.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interplay">Interplay<a class="hash-link" href="#interplay" title="Direct link to heading">​</a></h3><p>Next, we&#x27;ll walk through what happens when an Airflow instance with OpenLineage support runs a DAG, and how that operator data makes it to the Marquez or Datakin UI.</p><p>First, a DAG is born. When the DAG is run, the scheduler runs the operators in order by calling their <code>execute()</code> method. This is the first time the OpenLineage <code>Listener</code> responds. Triggered by the <code>execute()</code> event, it calls the <code>Manager</code>, which identifies the correct extractor based on the <code>task_id</code>. Then the <code>Extractor</code>&#x27;s <code>execute()</code> method is run, potentially returning lineage data in the form of a metadata object. When the operator is done--either succeeded or failed--, the <code>Listener</code> calls the <code>Manager</code> again, and this time the <code>Manager</code> triggers the <code>Extractor</code>&#x27;s <code>execute_on_complete()</code> method, which may also return metadata based on the result of the task. The metadata object is then sent to Marquez or Datakin, where the data is displayed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sql-check-operatorsextractors">SQL Check Operators/Extractors<a class="hash-link" href="#sql-check-operatorsextractors" title="Direct link to heading">​</a></h3><p>The <code>SQLCheckOperators</code> and <code>SQLCheckExtractors</code> work slightly differently than the interplay outlined above. The biggest difference is that the <code>SQLCheckExtractors</code> all inherit from a <code>BaseSqlCheckExtractor</code>, which in turn <em>dynamically</em> inherits from the appropriate extractor at run time. The appropriate extractor is always some existing SQL database extractor. The <code>BaseSqlCheckExtractor</code> itself only implements the <code>extract_on_complete()</code> method by determining whether the super class’s <code>extract()</code> or <code>extract_on_complete()</code> method should be run to gather metadata. The <code>_get_input_facets()</code> methods are all implemented by the particular check extractors, and are called in the super class’s <code>extract()</code> or <code>extract_on_complete()</code> method.</p><p>The dynamic inheritance is done by defining the <code>SQLCheckExtractors</code> inside the <code>get_check_extractors()</code> function that takes a class as a parameter and passes that class to the constructor of the <code>BaseSqlCheckExtractor</code>. When a <code>SQLCheckOperator</code> is run, and the <code>Manager</code> searches for the correct extractor to use, it calls <code>instantiate_abstract_extractors()</code> with the given task instance.</p><p>In this function, the task instance is used to find the correct extractor that will be the superclass of the <code>BaseSqlCheckOperator</code>. To do this, the function uses a set of hard-coded operator names whose extractors will dynamically inherit from the found superclass. Currently, this list is the set of <code>SQLCheckOperator</code>s, which corresponds to a dictionary of extractor keys and <code>conn_type</code> values. The given task’s class name is checked against the set of operator names, and if it is in the set, a loop compares the existing extractor’s corresponding <code>conn_type</code> from the aforementioned dictionary to the given task instance’s <code>conn_type</code> retrieved from Airflow connections. If there’s a match, the <code>get_check_extractors()</code> method is called with the matched extractor, instantiating all the operators with the correct superclass.</p><p>The <code>SQLCheckExtractors</code> only rely on the <code>extract_on_complete()</code> method, as the values needed from the operators, i.e. the results of the query and the success or failures of the checks, are only available after the operator completes.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/extractors"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Pursuing Lineage from Airflow using Custom Extractors</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/column-lineage"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">The Current State of Column-level Lineage</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#integration" class="table-of-contents__link toc-highlight">Integration</a><ul><li><a href="#the-operator-and-the-extractor" class="table-of-contents__link toc-highlight">The Operator and the Extractor</a></li><li><a href="#interplay" class="table-of-contents__link toc-highlight">Interplay</a></li><li><a href="#sql-check-operatorsextractors" class="table-of-contents__link toc-highlight">SQL Check Operators/Extractors</a></li></ul></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.6d0b7952.js"></script>
<script src="/assets/js/main.10b49ce1.js"></script>
</body>
</html>